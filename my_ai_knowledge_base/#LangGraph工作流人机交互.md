# #LangGraphå·¥ä½œæµäººæœºäº¤äº’   
ä¸‹é¢æˆ‘ç»™ä½ ä¸€ä»½ ****å®ç”¨ã€å·¥ç¨‹çº§çš„ã€ŠLangGraph å·¥ä½œæµäººæœºäº¤äº’ï¼ˆHuman-in-the-Loop, HITLï¼‰æŒ‡å—ã€‹****ã€‚â€¨ä¾§é‡ç‚¹æ˜¯ï¼š****è®©å¤æ‚ Agent / RAG å·¥ä½œæµçœŸæ­£åšåˆ°â€œèƒ½åœä¸‹æ¥ç­‰äººç±»è¾“å…¥ï¼Œå†ç»§ç»­æ‰§è¡Œâ€çš„èƒ½åŠ›ã€‚****  
è¿™åœ¨ç”Ÿäº§ç‰ˆ AI ç³»ç»Ÿä¸­éå¸¸å…³é”®ï¼Œå°¤å…¶æ˜¯ï¼š  
* å·¥å…·æ‰§è¡Œéœ€è¦ç”¨æˆ·ç¡®è®¤  
* RAG éœ€è¦ç”¨æˆ·è¡¥å……ä¸Šä¸‹æ–‡  
* Agent è§„åˆ’æœ‰å¤šç§é€‰é¡¹éœ€äººä¸ºé€‰æ‹©  
* é«˜é£é™©æ“ä½œéœ€äººå·¥å®¡æ‰¹  
* å¤šé˜¶æ®µä»»åŠ¡éœ€ä¸­é€”äººå·¥ä»‹å…¥  
LangGraph æ˜¯ç›®å‰æœ€é€‚åˆåš HITL çš„æ¡†æ¶ï¼Œå®ƒçš„ ****çŠ¶æ€æœº + checkpoint + ä¸­æ–­æœºåˆ¶**** å¤©ç„¶æ”¯æŒè¿™ä¸€èƒ½åŠ›ã€‚  
  
## ğŸš€** ä¸€ã€äººæœºäº¤äº’åœ¨ LangGraph ä¸­çš„æœ¬è´¨**  
ä¸€å¥è¯ï¼š  
**LangGraph é€šè¿‡å°†èŠ‚ç‚¹è®¾ä¸ºâ€œç­‰å¾…äº‹ä»¶ï¼ˆwait for user eventï¼‰â€çš„é˜»å¡ç‚¹ï¼Œå®ç°å·¥ä½œæµæš‚åœ + ç”¨æˆ·äº¤äº’ + æ¢å¤æ‰§è¡Œã€‚**  
**LangGraph é€šè¿‡å°†èŠ‚ç‚¹è®¾ä¸ºâ€œç­‰å¾…äº‹ä»¶ï¼ˆwait for user eventï¼‰â€çš„é˜»å¡ç‚¹ï¼Œå®ç°å·¥ä½œæµæš‚åœ + ç”¨æˆ·äº¤äº’ + æ¢å¤æ‰§è¡Œã€‚**  
å®ƒä¾èµ–ä¸‰ä¸ªèƒ½åŠ›ï¼š  
## âœ”** 1ï¼‰StateGraph â€”â€” å°†æ¯ä¸€æ­¥æ‹†æˆå¯æ§èŠ‚ç‚¹**  
## âœ”** 2ï¼‰checkpoint â€”â€” è®°å½•çŠ¶æ€ï¼Œæ–¹ä¾¿æ¢å¤**  
## âœ”** 3ï¼‰.send() â€”â€” ç”¨æˆ·å‘é€äº‹ä»¶ï¼Œæ¢å¤æ‰§è¡Œ**  
è¿™ä¸‰ä¸ªç»„åˆèµ·æ¥ï¼Œå°±å¯ä»¥æ„å»ºï¼š  
```
AI â†’ ç­‰å¾…ç”¨æˆ· â†’ AI â†’ ç­‰å¾…ç”¨æˆ· â†’ AI

```
çš„å®Œæ•´é“¾è·¯ã€‚  
  
## ğŸ§±** äºŒã€å®ç°äººæœºäº¤äº’çš„ä¸‰ç§æ–¹å¼**  
LangGraph æ”¯æŒä¸‰ç§ HITL æ¨¡å¼ï¼š  
****æ–¹å¼ 1ï¼šç­‰å¾…ç”¨æˆ·äº‹ä»¶ï¼ˆChatGPT Agent äº¤äº’æ¨¡å‹ï¼‰****  
****æ–¹å¼ 1ï¼šç­‰å¾…ç”¨æˆ·äº‹ä»¶ï¼ˆChatGPT Agent äº¤äº’æ¨¡å‹ï¼‰****  
****æ–¹å¼ 1ï¼šç­‰å¾…ç”¨æˆ·äº‹ä»¶ï¼ˆChatGPT Agent äº¤äº’æ¨¡å‹ï¼‰****  
æœ€å¸¸è§ï¼Œä¹Ÿæ˜¯å®˜æ–¹æ¨èã€‚  
å…³é”®æ–¹æ³•æ˜¯ï¼š  
**app.stream()**  
ç”¨äºæ‰§è¡Œå›¾å¹¶åœ¨â€œç­‰å¾…äººç±»äº‹ä»¶ï¼ˆHuman eventï¼‰â€æ—¶æš‚åœã€‚  
**app.send()**  
ç”¨äºç»§ç»­æ‰§è¡Œå›¾ã€‚  
è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯ HITL çš„æ ¸å¿ƒã€‚  
  
## ğŸ§ª** ä¸‰ã€æœ€å°å¯è¿è¡Œçš„äººæœºäº¤äº’ Demo**  
ä¸‹é¢è¿™ä¸ªä¾‹å­ä½ å¯ä»¥ç›´æ¥ç”¨æ¥æ„å»ºâ€œç”¨æˆ·ç¡®è®¤ â†’ AI ç»§ç»­æ‰§è¡Œâ€çš„æµç¨‹ã€‚  
## âœ”** State å®šä¹‰**  
```
from typing import TypedDict, List
from langchain_core.messages import BaseMessage

class State(TypedDict):
    messages: List[BaseMessage]
    user_confirm: bool

```
## âœ”** èŠ‚ç‚¹ï¼šè®© AI æé—®â€œæ˜¯å¦ç»§ç»­ï¼Ÿâ€**  
```
def ask_user(state: State):
    return {
        "messages": state["messages"] + [
            AIMessage("æˆ‘æ‰¾åˆ°äº†æ–¹æ¡ˆï¼Œä½ è¦ç»§ç»­å—ï¼Ÿè¾“å…¥ yes/no")
        ]
    }

```
## âœ”** é˜»å¡èŠ‚ç‚¹ï¼šç­‰å¾…ç”¨æˆ·è¾“å…¥äº‹ä»¶**  
```
from langgraph.types import Interrupt

def wait_user(state: State):
    raise Interrupt("need_user_input")

```
## âœ”** ç”¨æˆ·ç¡®è®¤åçš„æ‰§è¡ŒèŠ‚ç‚¹**  
```
def continue_work(state: State):
    return {
        "messages": state["messages"] + [
            AIMessage("å¥½çš„ï¼Œæˆ‘ç»§ç»­æ‰§è¡Œä»»åŠ¡")
        ]
    }

```
## âœ”** Routerï¼šåˆ¤æ–­æ˜¯å¦ç»§ç»­**  
```
def router(state: State):
    if state.get("user_confirm") is True:
        return "continue"
    else:
        return "end"

```
  
## ğŸ§ ** æ„å»ºå®Œæ•´ LangGraph å·¥ä½œæµ**  
```
from langgraph.graph import StateGraph, END

graph = StateGraph(State)

graph.add_node("ask", ask_user)
graph.add_node("wait", wait_user)
graph.add_node("continue", continue_work)

graph.add_edge("ask", "wait")
graph.add_conditional_edges("wait", router, 
    {"continue": "continue", "end": END})

graph.set_entry_point("ask")

app = graph.compile()

```
  
## ğŸ®** å››ã€è¿è¡Œï¼šäººæœºäº¤äº’å®Œæ•´æµç¨‹**  
## âœ”** ç¬¬ 1 æ­¥ï¼šè¿è¡Œ app.stream()**  
```
events = app.stream(
    {"messages": [HumanMessage("å¼€å§‹ä»»åŠ¡")]},
    config={"thread_id": "123"}
)

for e in events:
    print(e)

```
è¾“å‡ºä¼šç±»ä¼¼ï¼š  
```
AI: æˆ‘æ‰¾åˆ°äº†æ–¹æ¡ˆï¼Œä½ è¦ç»§ç»­å—ï¼Ÿè¾“å…¥ yes/no
ç­‰å¾…äº‹ä»¶ï¼šneed_user_input

```
å·¥ä½œæµæš‚åœäº†ã€‚  
  
## âœ”** ç¬¬ 2 æ­¥ï¼šç”¨æˆ·å›åº”ï¼ˆsendï¼‰**  
```
events = app.send(
    {"user_confirm": True},
    config={"thread_id": "123"}
)

for e in events:
    print(e)

```
è¾“å‡ºï¼š  
```
AI: å¥½çš„ï¼Œæˆ‘ç»§ç»­æ‰§è¡Œä»»åŠ¡

```
æµç¨‹ç»§ç»­è¿è¡Œåˆ°ç»“æŸã€‚  
  
## ğŸ§ ** äº”ã€å¸¸è§çš„äººæœºäº¤äº’æ¨¡å¼ï¼ˆçœŸå®äº§å“åœºæ™¯ï¼‰**  
****æ¨¡å¼ Aï¼šç”¨æˆ·ç¡®è®¤ï¼ˆApprove/Rejectï¼‰****  
RAG æ£€ç´¢åˆ°å†…å®¹ï¼Œé—®ç”¨æˆ·ï¼š  
* æ˜¯å¦ä½¿ç”¨è¯¥æ–‡æ¡£ï¼Ÿ  
* æ˜¯å¦æ‰§è¡Œè¿™ä¸ª SQLï¼Ÿ  
* æ˜¯å¦æ‰“å¼€è¿™ä¸ª URLï¼Ÿ  
* æ˜¯å¦åŒæ„å·¥å…·æ“ä½œï¼Ÿ  
ä»£ç ï¼šç­‰å¾…äº‹ä»¶ â†’ ç”¨æˆ· .send() â†’ è·¯ç”±ç»§ç»­ã€‚  
  
****æ¨¡å¼ Bï¼šè¡¥å……ç¼ºå¤±ä¿¡æ¯****  
Agent å‘ç°ç”¨æˆ·è¾“å…¥ç¼ºå°‘ä¿¡æ¯æ—¶è‡ªåŠ¨é—®ï¼š  
```
ä½ è¦æŸ¥è¯¢å“ªä¸ªå®¢æˆ·ï¼Ÿ

```
ç­‰å¾…å†™å…¥ï¼š  
```
app.send({"customer_id": "U48291"})

```
ç„¶åç»§ç»­æ‰§è¡Œã€‚  
  
****æ¨¡å¼ Cï¼šå¤šé€‰æ“ä½œï¼ˆç”¨æˆ·é€‰æ‹©åˆ†æ”¯ï¼‰****  
****æ¨¡å¼ Cï¼šå¤šé€‰æ“ä½œï¼ˆç”¨æˆ·é€‰æ‹©åˆ†æ”¯ï¼‰****  
****æ¨¡å¼ Cï¼šå¤šé€‰æ“ä½œï¼ˆç”¨æˆ·é€‰æ‹©åˆ†æ”¯ï¼‰****  
AI ç»™å‡ºä¸‰ä¸ªè®¡åˆ’ï¼š  
* æ–¹æ¡ˆ Aï¼šå¿«é€Ÿæ‰§è¡Œ  
* æ–¹æ¡ˆ Bï¼šå®‰å…¨ä¼˜å…ˆ  
* æ–¹æ¡ˆ Cï¼šæˆæœ¬æœ€ä½  
ç”¨æˆ·é€‰æ‹©ï¼š  
```
é€‰ B

```
Graph è·¯ç”±åˆ° B èŠ‚ç‚¹æ‰§è¡Œã€‚  
  
****æ¨¡å¼ Dï¼šäººç±»å®¡æŸ¥ + AI ç»§ç»­****  
æ¯”å¦‚ï¼š  
* è´¢åŠ¡å®¡æ‰¹  
* æ³•å¾‹æ–‡ä¹¦æ ¡å¯¹  
* æ•æ„Ÿæ“ä½œç¡®è®¤  
AI åœä¸‹ â†’ äºº review â†’ AI ç»§ç»­ã€‚  
  
****æ¨¡å¼ Eï¼šä»»åŠ¡æ‹†è§£ + ç”¨æˆ·å†³ç­–****  
****æ¨¡å¼ Eï¼šä»»åŠ¡æ‹†è§£ + ç”¨æˆ·å†³ç­–****  
****æ¨¡å¼ Eï¼šä»»åŠ¡æ‹†è§£ + ç”¨æˆ·å†³ç­–****  
AI è§„åˆ’å‡º 5 ä¸ªå­ä»»åŠ¡ï¼š  
```
æ˜¯å¦æ‰§è¡Œå­ä»»åŠ¡3ï¼Ÿ

```
ä½ å¯ä»¥å†³å®šæ‰§è¡Œå“ªäº›ã€‚  
  
## ğŸ§°** å…­ã€å’Œ LangChain ç›¸æ¯”çš„ä¼˜åŠ¿ï¼Ÿ**  
LangChain åªèƒ½ï¼š  
* Memory å­˜æ¶ˆæ¯  
* Tool è°ƒç”¨  
* æ— æ³•æš‚åœæ‰§è¡Œ  
* æ— æ³•æ¢å¤æ‰§è¡Œ  
* å·¥ç¨‹èƒ½åŠ›ä¸è¶³  
LangGraphï¼š  
* Node = ç‹¬ç«‹æ­¥éª¤  
* çŠ¶æ€å¯æŒä¹…åŒ–  
* å¯æš‚åœ  
* å¯æ¢å¤  
* å…¨å±€çŠ¶æ€å¯æ§  
* äººæœºäº¤äº’å¤©ç„¶æ”¯æŒ  
LangGraph = ä¼ä¸šçº§ Agent ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨ã€‚  
  
## ğŸ§¨** ä¸ƒã€å·¥ç¨‹çº§æœ€ä½³å®è·µ**  

| ä½¿ç”¨åœºæ™¯         | å»ºè®®                          |
| ------------ | --------------------------- |
| SaaSã€Chatbot | SQLCheckpointerï¼ˆå¤šç”¨æˆ·æŒä¹…åŒ–ï¼‰     |
| Agent å·¥ä½œæµ    | æŠŠæ‰€æœ‰ç”¨æˆ·åˆ†æ”¯éƒ½åšæˆ Interrupt        |
| è¡¨å•è¡¥å……         | ä½¿ç”¨äº‹ä»¶å­—æ®µ user_event:{â€¦}       |
| å·¥å…·æ‰§è¡Œç¡®è®¤       | wait â†’ user_confirm â†’ route |
| å®¡è®¡å›æ”¾         | å¯ç”¨ run history + checkpoint |
  
## ğŸ¯** å…«ã€æ€»ç»“ï¼ˆæœ¬è´¨ç†è§£ï¼‰**  
LangGraph çš„äººæœºäº¤äº’èƒ½åŠ›æ¥è‡ªï¼š  
## âœ”** æœ‰çŠ¶æ€ï¼ˆstateï¼‰**  
## âœ”** å¯ä¸­æ–­ï¼ˆInterruptï¼‰**  
## âœ”** å¯æ¢å¤ï¼ˆsend/resumeï¼‰**  
## âœ”** å¯æŒä¹…åŒ–ï¼ˆcheckpointï¼‰**  
## âœ”** å¯è·¯ç”±ï¼ˆconditional edgesï¼‰**  
è¿™äº”ä¸ªèƒ½åŠ›ç»„åˆï¼Œè®© LangGraph æˆä¸ºç›®å‰æœ€é€‚åˆåš â€œHITL Agentâ€ çš„æ¡†æ¶ã€‚  
ä¸€å¥è¯æ€»ç»“ï¼š  
**LangGraph ä¸æ˜¯ç®€å•çš„ LLM Pipelineï¼Œè€Œæ˜¯å¯ä»¥æš‚åœã€ç­‰å¾…ã€æ¢å¤ã€åˆ†æ”¯çš„çŠ¶æ€æœºã€‚**  
**LangGraph ä¸æ˜¯ç®€å•çš„ LLM Pipelineï¼Œè€Œæ˜¯å¯ä»¥æš‚åœã€ç­‰å¾…ã€æ¢å¤ã€åˆ†æ”¯çš„çŠ¶æ€æœºã€‚**  
  
å¦‚æœä½ éœ€è¦ï¼Œæˆ‘è¿˜èƒ½ç»§ç»­æä¾›ï¼š  
## ğŸ”¥** äººæœºäº¤äº’ + RAG çš„å®Œæ•´ Demo**  
## ğŸ”¥** äººæœºäº¤äº’ + å¤š Agentï¼ˆPlanner / Executorï¼‰ç¤ºä¾‹**  
## ğŸ”¥** äººæœºäº¤äº’ + SQL Agentï¼ˆç”¨æˆ·ç¡®è®¤ SQLï¼‰**  
## ğŸ”¥** äººæœºäº¤äº’ + å·¥å…·ï¼ˆæµè§ˆå™¨ / APIï¼‰å®‰å…¨æ‰§è¡Œ**  
## ğŸ”¥** ç”¨ LangGraph æ„å»º GPTs çš„è‡ªå®šä¹‰äº¤äº’èƒ½åŠ›**  
ä½ éœ€è¦å“ªä¸€ä¸ªï¼Ÿ  
